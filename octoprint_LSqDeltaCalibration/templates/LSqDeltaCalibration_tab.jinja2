<form id="tab_plugin_LSqDeltaCalibration" class="form-horizontal">
  <ul class="nav nav-pills">
    <li class="active">
      <a href="#calibrate_tab" data-toggle="tab">{{ _('Calibrate') }}</a>
    </li>
    <li>
      <a href="#settings_tab" data-toggle="tab">{{ _('Settings') }}</a>
    </li>
    <li>
      <a href="#about_tab" data-toggle="tab">{{ _('About') }}</a>
    </li>
  </ul>

  <div class="tab-content">

    <div id="settings_tab" class="tab-pane">

              <div class="control-group">
          <label class="control-label">{{ _('Probing Radius') }} :</label>
          <div class="input-append">
              <input type="number" data-bind="value: probeRadius" step="1" class="input-small"/>
          </div>
      </div>
      <div class="control-group">
          <label class="control-label">{{ _('Probe points') }} :</label>
          <div class="input-append">
              <input type="number" data-bind="value: probePointCount" step="1" class="input-small"/>
          </div>
      </div>
      <div class="control-group">
        <label class="control-label">{{ _('Simulation mode') }} :</label>
        <div class="input-append">
          <input type="checkbox" data-bind="checked: isSimulation" title="{{ _('Simulate printer responses for testing purposes.') }}" />
        </div>
      </div>
      <div class="control-group">
        <label class="control-label">{{ _('Test mode') }} :</label>
        <div class="input-append">
          <input type="checkbox" data-bind="checked: isTest" title="{{ _('TestingMode.') }}" />
        </div>
      </div>
    </div>

    <div id="calibrate_tab" class="tab-pane active">

      <div class="alert" data-bind="visible: !isPrinterReady() && !isSimulation()">
        {{ _('Please connect your printer to get its capabilities') }}
      </div>

      <h4>
        <a href="#collapseGeometry" id="collapseGeometryControl" data-toggle="collapse" class="collapsed" data-bind="visible: isGeometryKnown"><i class="fa fa-caret-right fa-lg"></i><i class="fa fa-caret-down fa-lg"></i></a>
        {{ _('Current Geometry') }}
        <button class="btn btn-primary pull-right" data-bind="click: fetchGeometry, enable: isReadyForCommands()" title="{{ _('Reads the current geometry from the machine.') }}">{{ _('Fetch Geometry') }}</button>
      </h4>
      <div class="row-fluid collapse" data-bind="" id="collapseGeometry">
        <div class="row-fluid">
          <div class="span3">
            <H5>Parameter</H5>
          </div>
          <div class="input-append span6">
            <H5>Value</H5>
          </div>
        </div>

        <div class="row-fluid">
          <div class="span3">{{ _('Steps per unit') }}</div>
          <div class="span2" data-bind="text: currentGeometry().StepsPerUnit[0].toFixed(4)"></div>
          <div class="span2" data-bind="text: currentGeometry().StepsPerUnit[1].toFixed(4)"></div>
          <div class="span2" data-bind="text: currentGeometry().StepsPerUnit[2].toFixed(4)"></div>
        </div>

        <div class="row-fluid">
          <div class="span3">{{ _('Tower Offset') }}</div>
          <div class="span2" data-bind="text: currentGeometry().TowerOffset[0].toFixed(4)"></div>
          <div class="span2" data-bind="text: currentGeometry().TowerOffset[1].toFixed(4)"></div>
          <div class="span2" data-bind="text: currentGeometry().TowerOffset[2].toFixed(4)"></div>
        </div>

        <div class="row-fluid">
          <div class="span3">{{ _('Max Height') }}</div>
          <div class="span6" data-bind="text: currentGeometry().Height.toFixed(4)"></div>
        </div>

        <div class="row-fluid">
          <div class="span3">{{ _('Endstop Offset') }}</div>
          <div class="span2" data-bind="text: currentGeometry().EndStopOffset[0].toFixed(4)"></div>
          <div class="span2" data-bind="text: currentGeometry().EndStopOffset[1].toFixed(4)"></div>
          <div class="span2" data-bind="text: currentGeometry().EndStopOffset[2].toFixed(4)"></div>
        </div>

        <div class="row-fluid">
          <div class="span3">{{ _('Rod Length') }}</div>
          <div class="span6" data-bind="text: currentGeometry().DiagonalRod.toFixed(4)"></div>
        </div>

        <div class="row-fluid">
          <div class="span3">{{ _('Rod Length Adjust') }}</div>
          <div class="span2" data-bind="text: currentGeometry().DiagonalRodAdjust[0].toFixed(4)"></div>
          <div class="span2" data-bind="text: currentGeometry().DiagonalRodAdjust[1].toFixed(4)"></div>
          <div class="span2" data-bind="text: currentGeometry().DiagonalRodAdjust[2].toFixed(4)"></div>
        </div>

        <div class="row-fluid">
          <div class="span3">{{ _('Delta Radius') }}</div>
          <div class="span6" data-bind="text: currentGeometry().Radius.toFixed(4)"></div>
        </div>

        <div class="row-fluid">
          <div class="span3">{{ _('Delta Radius Adjust') }}</div>
          <div class="span2" data-bind="text: currentGeometry().RadiusAdjust[0].toFixed(4)"></div>
          <div class="span2" data-bind="text: currentGeometry().RadiusAdjust[1].toFixed(4)"></div>
          <div class="span2" data-bind="text: currentGeometry().RadiusAdjust[2].toFixed(4)"></div>
        </div>
      </div>

      <script type="text/html" id="ProbingDataTemplate">
        <span data-bind="visible: RMS">
          {{ _('RMS') }}: <span data-bind="text: RMS.toFixed(3)"></span>
          {{ _('Min') }}: <span data-bind="text: Min.toFixed(3)"></span>
          {{ _('Max') }}: <span data-bind="text: Max.toFixed(3)"></span>
        </span>
      </script>
      
      <h4>
        <a href="#collapsePlot" id="collapsePlotControl"  data-toggle="collapse" class="collapsed" data-bind="visible: ProbedData().RMS"><i class="fa fa-caret-right fa-lg"></i><i class="fa fa-caret-down fa-lg"></i></a>
        {{ _('Probing') }} <span data-bind="template: { name: 'ProbingDataTemplate', if:ProbedData().RMS , data: ProbedData }"></span>
        <button class="btn btn-primary pull-right" data-bind="click: probeBed, enable: isReadyForCommands() && isGeometryKnown">{{ _('Probe bed') }}</button>
      </h4>
      <div class="row-fluid collapse" id="collapsePlot">
        <div class="row-fluid" id="surfacePlotDiv" style="width: 100%; height: 400px;"></div>
      </div>

      <div class="row-fluid">
        <h4>
          <a href="#collapseCalibration" id="collapseCalibrationControl"  data-toggle="collapse" class="collapsed" data-bind="visible: isReadyToCalibrate()"><i class="fa fa-caret-right fa-lg"></i><i class="fa fa-caret-down fa-lg"></i></a>
          {{ _('Calibration') }} <span data-bind="template: { name: 'ProbingDataTemplate', if:CalibratedData , data: CalibratedData }"></span>
          <button class="btn btn-primary pull-right" data-bind="click: configureGeometry, enable: isReadyToCalibrate()" title="{{ _('Configure the machine with the calibrated geometry.') }}">{{ _('Calibrate') }}</button>
        </h4>
        <div class="row-fluid collapse" id="collapseCalibration">
          <div class="row-fluid">
            <div class="span3">
              <H5>Parameter</H5>
            </div>
            <div class="input-append span6">
              <H5>Value</H5>
            </div>
            <div class="input-append span1">
              <H5>Calibrate</H5>
            </div>
          </div>

          <div class="row-fluid">
            <div class="span3">{{ _('Steps per unit') }}</div>
            <div class="span2" data-bind="text: newGeometry().StepsPerUnit[0].toFixed(4)"></div>
            <div class="span2" data-bind="text: newGeometry().StepsPerUnit[1].toFixed(4)"></div>
            <div class="span2" data-bind="text: newGeometry().StepsPerUnit[2].toFixed(4)"></div>
            <div class="input-append span1">
              <input type="checkbox" data-bind="checked: calibrate.StepsPerUnit" title="{{ _('Calibrate') }}" />
            </div>
          </div>

          <div class="row-fluid">
            <div class="span3">{{ _('Tower Offset') }}</div>
            <div class="span2" data-bind="text: newGeometry().TowerOffset[0].toFixed(4)"></div>
            <div class="span2" data-bind="text: newGeometry().TowerOffset[1].toFixed(4)"></div>
            <div class="span2" data-bind="text: newGeometry().TowerOffset[2].toFixed(4)"></div>
            <div class="input-append span1">
              <input type="checkbox" data-bind="checked: calibrate.TowerOffset" title="{{ _('Calibrate') }}" />
            </div>
          </div>

          <div class="row-fluid">
            <div class="span3">{{ _('Max Height') }}</div>
            <div class="span6" data-bind="text: newGeometry().Height.toFixed(4)"></div>
            <div class="input-append span1">
              <input type="checkbox" data-bind="checked: calibrate.MaxHeight" title="{{ _('Calibrate') }}" />
            </div>
          </div>

          <div class="row-fluid">
            <div class="span3">{{ _('Endstop Offset') }}</div>
            <div class="span2" data-bind="text: newGeometry().EndStopOffset[0].toFixed(4)"></div>
            <div class="span2" data-bind="text: newGeometry().EndStopOffset[1].toFixed(4)"></div>
            <div class="span2" data-bind="text: newGeometry().EndStopOffset[2].toFixed(4)"></div>
            <div class="input-append span1">
              <input type="checkbox" data-bind="checked: calibrate.EndStopOffset" title="{{ _('Calibrate') }}" />
            </div>
          </div>

          <div class="row-fluid">
            <div class="span3">{{ _('Rod Length') }}</div>
            <div class="span6" data-bind="text: newGeometry().DiagonalRod.toFixed(4)"></div>
            <div class="input-append span1">
              <input type="checkbox" data-bind="checked: calibrate.RodLength" title="{{ _('Calibrate') }}" />
            </div>
          </div>

          <div class="row-fluid">
            <div class="span3">{{ _('Rod Length Adjust') }}</div>
            <div class="span2" data-bind="text: newGeometry().DiagonalRodAdjust[0].toFixed(4)"></div>
            <div class="span2" data-bind="text: newGeometry().DiagonalRodAdjust[1].toFixed(4)"></div>
            <div class="span2" data-bind="text: newGeometry().DiagonalRodAdjust[2].toFixed(4)"></div>
            <div class="input-append span1">
              <input type="checkbox" data-bind="checked: calibrate.RodLenghtAdjust" title="{{ _('Calibrate') }}" />
            </div>
          </div>

          <div class="row-fluid">
            <div class="span3">{{ _('Delta Radius') }}</div>
            <div class="span6" data-bind="text: newGeometry().Radius.toFixed(4)"></div>
            <div class="input-append span1">
              <input type="checkbox" data-bind="checked: calibrate.DeltaRadius" title="{{ _('Calibrate') }}" />
            </div>
          </div>

          <div class="row-fluid">
            <div class="span3">{{ _('Delta Radius Adjust') }}</div>
            <div class="span2" data-bind="text: newGeometry().RadiusAdjust[0].toFixed(4)"></div>
            <div class="span2" data-bind="text: newGeometry().RadiusAdjust[1].toFixed(4)"></div>
            <div class="span2" data-bind="text: newGeometry().RadiusAdjust[2].toFixed(4)"></div>
            <div class="input-append span1">
              <input type="checkbox" data-bind="checked: calibrate.DeltaRadiusAdjust" title="{{ _('Calibrate') }}" />
            </div>
          </div>
        </div>
      </div> 
      <div class="row-fluid">
        <h4>
          <a href="#collapseGeoHistry" data-toggle="collapse" class="collapsed" data-bind="visible: probedGeometries().length > 0"><i class="fa fa-caret-right fa-lg"></i><i class="fa fa-caret-down fa-lg"></i></a>
          {{ _('Probing history') }}</h4>

        <div class="row-fluid collapse" id="collapseGeoHistry">
          <table class="table table-striped table-hover table-condensed table-hover" id="settings_deltaCalibration_probedGeometries">
            <thead>
              <tr>
                <th class="settings_deltaCalibration_probedGeometries_timestamp">{{ _('Timestamp') }}</th>
                <th class="settings_deltaCalibration_probedGeometries_RMS span2" >{{ _('RMS') }}</th>
                <th class="settings_deltaCalibration_probedGeometries_name">{{ _('Name') }}</th>
                <th class="settings_deltaCalibration_probedGeometries_action span2">{{ _('Action') }}</th>
              </tr>
            </thead>
            <tbody data-bind="foreach: probedGeometries">
              <tr data-bind="attr: {title: name}">
                <td class="settings_deltaCalibration_probedGeometries_timestamp" data-bind="text: Timestamp"></td>
                <td class="settings_deltaCalibration_probedGeometries_RMS" data-bind="text: RMS"></td>
                <td class="settings_deltaCalibration_probedGeometries_name" data-bind="text: Name"></td>
                <td class="settings_deltaCalibration_probedGeometries_action">
                  <a href="#" class="fa fa-download" title="{{ _('Load geometry') }}"
                     data-bind="click: function() { $root.LoadGeometry($data) }"></a>
                  &nbsp;|&nbsp;
                  <a href="#" class="fa fa-trash-o" title="{{ _('Delete geometry') }}" data-bind="click: function() {$root.probedGeometries.remove($data); }"></a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
</div>
</form>
